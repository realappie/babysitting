{"version":3,"sources":["controllers/children.controller.js"],"names":["app","controller","$scope","$rootScope","$toast","$state","$firebaseArray","$stateParams","$timeout","children","birthday","name","emptyChildren","maxChildren","remoteChildrenLoaded","remoteChildren","editMode","console","log","edit","maxAge","moment","duration","minDate","subtract","toDate","maxDate","$watch","currentUser","undefined","uid","$id","database","child","$loaded","info","i","length","toPushChild","angular","copy","Date","push","updateAges","e","$watchCollection","date","age","fromNow","addChildForm","removeChild","index","indexOf","splice","$remove","then","saveChild","update","getTime","data","catch","err","error","addChild","$event","group","$add"],"mappings":"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","file":"controllers/children.controller.js","sourcesContent":["app.controller('childrenCtrl', ['$scope', '$rootScope', '$toast', '$state', '$firebaseArray','$stateParams', '$timeout', function($scope, $rootScope, $toast, $state, $firebaseArray, $stateParams, $timeout){\n\t\t$scope.children = [{birthday: null, name: null}];\n\t\t$scope.emptyChildren = true;\n\t\t$scope.maxChildren = false;   \n\t\t$scope.remoteChildrenLoaded = false;\n\t\t$scope.remoteChildren = [];\n\t\t$scope.editMode = false;\n\t\tconsole.log($stateParams.edit);\n\t\tif($stateParams.edit === \"true\"){\n\t\t\tconsole.log($stateParams.edit);\n\t\t\t$scope.editMode = true;\n\t\t\t$scope.children = [];\n\t\t}\n\n\t\t// Child max age\n\t\tvar maxAge = moment.duration(16, 'years');\t\t\n\t\t$scope.minDate = moment().subtract(maxAge, 'years').toDate();\n\t\t$scope.maxDate = moment().subtract(1, 'years').toDate();\n\n\t\t$rootScope.$watch('currentUserLoaded', function(){\n\t\t\tconsole.log($rootScope.currentUser);\n\t\t\tif($rootScope.currentUser !== undefined){\n\t\t\t\tvar uid = $rootScope.currentUser.$id;\n\t\t\t\t$scope.remoteChildren = $firebaseArray($scope.database.child('users/' + uid + '/children'));\n\t\t\t\t$scope.remoteChildren.$loaded(function(){\n\t\t\t\t\t$scope.remoteChildrenLoaded = true;\n\t\t\t\t\tif($scope.editMode){\n\t\t\t\t\t\tconsole.info('loading server data');\n\t\t\t\t\t\tfor(var i = 0; i < $scope.remoteChildren.length; i++){\n\t\t\t\t\t\t\tconsole.log($scope.remoteChildren[i]);\n\t\t\t\t\t\t\t$scope.toPushChild = angular.copy($scope.remoteChildren[i]);\n\t\t\t\t\t\t\t$scope.toPushChild.birthday = new Date($scope.toPushChild.birthday);\n\t\t\t\t\t\t\t$scope.children.push($scope.toPushChild);\n\t\t\t\t\t\t\t$scope.updateAges();\n\t\t\t\t\t\t}\n\t\t\t\t\t}\t\t\t\t\t\n\t\t\t\t})\n\t\t\t\t$scope.remoteChildren.$watch(function(e){\n\t\t\t\t\tconsole.log($scope.remoteChildren.length);\n\t\t\t\t\tif($scope.remoteChildren.length + $scope.children.length >= 3){\n\t\t\t\t\t\t$scope.maxChildren = true;\t\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t}\n\t\t});\n\n\t\t/*Wrapped in a function because the collection will be checked once the controller is fired up, and at that point the children\n\t\tArray doesn't exist so this code would cause errors.*/\n\n\t\t$scope.$watchCollection('children', function(){\n\t\t\t$scope.emptyChildren = false;\n\t\t\tif($scope.children.length > 2){\n\t\t\t\t$scope.maxChildren = true;\n\t\t\t}\t\t\t\t\n\t\t\tif($scope.children.length == 0 && $scope.remoteChildren.length == 0){\n\t\t\t\t$scope.emptyChildren = true;\n\t\t\t}\t\t\t\n\t\t\tif($scope.remoteChildren.length + $scope.children.length >= 3){\n\t\t\t\t$scope.maxChildren = true;\t\n\t\t\t}\n\t\t});\n\n\t\t$scope.updateAges = function(){\n\t\t\tfor (var i = 0; i < $scope.children.length; i++) {\n\t\t\t\tvar date = moment(new Date($scope.children[i].birthday));\n\t\t\t\tvar age = moment(date).fromNow(true);\n\t\t\t\t$scope.children[i].age = age;\n\t\t\t}\n\t\t}\n\n\t\t$scope.addChildForm = function(){\n\t\t\t$scope.children.push({birthday: null, name: null});\n\t\t}\n\n\t\t$scope.removeChild = function(child){\n\t\t\tvar index = $scope.children.indexOf(child);\n\t\t\t$scope.children.splice(index,1);\n\t\t\t$scope.maxChildren = false;\n\t\t\t$scope.remoteChildren.$remove(index)\n\t\t\t\t.then(function(){\n\t\t\t\t\tconsole.log(\"item removed\");\n\t\t\t\t\t$toast(child.name + \" removed\");\n\t\t\t\t})\n\t\t}\n\t\t$scope.saveChild = function(child){\n\t\t\tconsole.log(child);\n\t\t\t$scope.database.child('users/' + $rootScope.currentUser.$id + '/children/' + child.$id).update({\n\t\t\t\tname: child.name,\n\t\t\t\tbirthday: child.birthday.getTime()\n\t\t\t}).then(function(data){\n\t\t\t\t\tconsole.log(data);\n\t\t\t\t\t$toast('Child edited');\n\t\t\t\t})\n\t\t\t\t.catch(function(err){\n\t\t\t\t\tconsole.error(err);\n\t\t\t\t\t$toast('Child editing failed');\n\t\t\t\t});\n\t\t}\n\n\t\t$scope.addChild = function(child, $event, index){\n\t\t\tconsole.group('adding child');\n\t\t\tif($scope.remoteChildren.length >= 3){\n\t\t\t\t$toast('You already have 3 children');\n\t\t\t\t$scope.maxChildren = true;\n\t\t\t}else{\n\t\t\t\t$scope.remoteChildren.$add({\n\t\t\t\t\tname: child.name,\n\t\t\t\t\tbirthday: child.birthday.getTime()\n\t\t\t\t}).then(function(data){\n\t\t\t\t\tconsole.log(data);\n\t\t\t\t\t$toast(child.name + \" added\");\n\t\t\t\t}).catch(function(err){\n\t\t\t\t\tconsole.error(err);\n\t\t\t\t\t$toast('Adding child failed');\n\t\t\t\t})\n\t\t\t}\n\n\t\t}\n}])"],"sourceRoot":"/source/"}