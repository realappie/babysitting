{"version":3,"sources":["controllers/account.controller.js"],"names":["app","controller","$scope","$rootScope","$toast","$state","$stateParams","$firebaseArray","children","zeroChildren","childrenLoaded","currentUserLoaded","user","pages","parent","babysitter","personal","invalidPricingForm","pricingLoaded","pricingForm","ageGroups","tab","parentTab","$watch","undefined","currentUser","uid","$id","name","locationCity","zipCode","street","userTypes","icon","description","model","angular","copy","userType","babySitter","updatePricing","database","child","$loaded","then","data","length","once","val","defaultAgeGroups","$apply","catch","err","console","error","deleteChild","index","indexOf","log","$remove","updateProfile","updateProfileData","update","updateUserType","type","userPath","updateParentData","updateBabySitterData","pricing","photoURL","birthDay","email","savePricing","updatePricingData","ageGroupsToSave","map","obj","checkForms","i","$invalid"],"mappings":"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","file":"controllers/account.controller.js","sourcesContent":["app.controller('accountCtrl', ['$scope', '$rootScope', '$toast', '$state', '$stateParams', '$firebaseArray', \n    function($scope, $rootScope, $toast, $state, $stateParams, $firebaseArray) {\n    $scope.children = [];\n    $scope.zeroChildren = false;\n    $scope.childrenLoaded = false;\n    $scope.currentUserLoaded = false;\n    $scope.user = {};\n    $scope.pages = {\n        parent: 'pages/parent.html',\n        babysitter: 'pages/babysitter.html',\n        personal: 'pages/personalInfo.html'\n    }\n    $scope.invalidPricingForm = false;\n    $scope.pricingLoaded = false;\n    $scope.pricingForm = [];\n    $scope.ageGroups = {};\n    if($stateParams.tab == 'parent'){\n        $scope.parentTab = true;\n    }\n\n    $rootScope.$watch('currentUserLoaded', function() {\n        if ($rootScope.currentUser !== undefined) {\n            $scope.currentUserLoaded = true;\n            var uid = $rootScope.currentUser.$id;\n            // Needed info to show edit-able data\n            $scope.user = {\n                name: $rootScope.currentUser.name,\n                locationCity: $rootScope.currentUser.locationCity,\n                zipCode: $rootScope.currentUser.zipCode,\n                street: $rootScope.currentUser.street\n            }\n\n            $scope.userTypes = [{\n                \"icon\": \"person\",\n                \"description\": \"parent\",\n                \"model\": angular.copy($rootScope.currentUser.userType.parent)\n            }, {\n                \"icon\": \"child_friendly\",\n                \"description\": \"babysitter\",\n                \"model\": angular.copy($rootScope.currentUser.userType.babySitter)\n            }]\n            \n            $scope.updatePricing(uid);\n\n            $scope.children = $firebaseArray($scope.database.child('users/' + uid + '/children'));\n            $scope.children.$loaded()\n                .then(function(data) {\n                    $scope.childrenLoaded = true;\n                    data.length == 0 ? $scope.zeroChildren = true : $scope.zeroChildren = false;\n                })\n            $scope.children.$watch(function(){\n                $scope.children.length == 0 ? $scope.zeroChildren = true : $scope.zeroChildren = false;\n            })\n        }\n    });\n\n    $scope.updatePricing = function(uid) {\n        $scope.database.child('babysitters/' + uid + '/pricing').once('value')\n            .then(function(data) {\n                if (data.val() === null) {     \n                    $scope.ageGroups = angular.copy($rootScope.defaultAgeGroups);\n                }else{\n                \t$scope.ageGroups = data.val();\n                }\n                $scope.pricingLoaded = true;\n                $scope.$apply();\n            })\n            .catch(function(err) {\n                console.error(err);\n            })\n    }\n\n    $scope.deleteChild = function(child) {\n        var index = $scope.children.indexOf(child);\n        console.log(child);\n        console.log(index);\n        $scope.children.$remove(index)\n            .then(function() {\n                console.log(\"item removed\");\n                $toast(child.name + \" removed\");\n            });\n        console.log($scope.children);\n        if ($scope.children.length == 0) {\n            $scope.zeroChildren = true;\n        }\n    }\n\n    $scope.updateProfile = function() {\n    \t// errors here, babysitter write is valid, probably something going wrong with the users write, check out online site for code comparsion\n    \tvar updateProfileData = {};\n        updateProfileData['users/' + $scope.currentUser.$id + '/name'] = $scope.user.name;\n        updateProfileData['users/' + $scope.currentUser.$id + '/locationCity'] = $scope.user.locationCity;\n        if($scope.currentUser.userType.parent){\n           updateProfileData['users/' + $scope.currentUser.$id + '/zipCode'] = $scope.user.zipCode;\n    \t   updateProfileData['users/' + $scope.currentUser.$id + '/street'] = $scope.user.street;\n        }else{\n           updateProfileData['babysitters/' + $scope.currentUser.$id + '/name'] = $scope.user.name;\n    \t   updateProfileData['babysitters/' + $scope.currentUser.$id + '/locationCity'] = $scope.user.locationCity;            \n        }\n\n    \tconsole.log(updateProfileData);\n        $scope.database.update(updateProfileData)\n            .then(function(data) {\n                console.log(data);\n            })\n            .catch(function(err) {\n                console.error(err);\n            })\n    }\n\n    $scope.updateUserType = function(type) {\n        var userPath = 'users/' + $scope.currentUser.$id;\n        var uid = $scope.currentUser.$id;\n\n        if (type.description === \"parent\") {\n            var updateParentData = {}\n            updateParentData[userPath + '/userType/parent'] = type.model;\n            if ($rootScope.currentUser.userType.parent) {\n                console.log('deleting children node');\n                updateParentData[userPath + '/children/'] = null;\n            }\n            $scope.database.update(updateParentData)\n                .then(function(data) {\n                    $toast('Successfully changed account');\n                    console.log(data);\n                })\n                .catch(function(err) {\n                    console.log(error);\n                })\n        }\n\n        if (type.description === 'babysitter') {\n            var updateBabySitterData = {};\n\n            updateBabySitterData[userPath + '/userType/babySitter'] = type.model;\n\n            if ($rootScope.currentUser.userType.babySitter) {\n                // The user is currently a babysitter, but does not want it anymore. Delete babysitter associated data\n                updateBabySitterData[userPath + \"/pricing\"] = null;\n                updateBabySitterData['babysitters/' + uid] = null;\n            } else {\n                // The user is not a babysitter, but wants to become one\n                updateBabySitterData['babysitters/' + uid] = {\n                    pricing: $rootScope.defaultAgeGroups,\n                    photoURL: $scope.currentUser.photoURL,\n                    locationCity: $scope.currentUser.locationCity,\n                    birthDay: $scope.currentUser.birthDay,\n                    email: $scope.currentUser.email,\n                    name: $scope.currentUser.name\n                }\n\n                updateBabySitterData['users/' + uid + '/pricing'] = $rootScope.defaultAgeGroups;\n                \n                $scope.updatePricing(uid);\n            }\n\n            $scope.database.update(updateBabySitterData)\n                .then(function(data) {\n                    $toast('Successfully changed account');\n                    console.log(data);\n                })\n                .catch(function(err) {\n                    console.log(err);\n                })\n        }\n        console.log(type.model);\n        console.log($rootScope.currentUser.userType);\n    }\n\n    $scope.savePricing = function() {\n        var updatePricingData = {};\n        var uid = $scope.currentUser.$id;\n\n        $scope.ageGroupsToSave = $scope.ageGroups.map(function(obj) {\n            delete obj[\"$$hashKey\"];\n            return obj;\n        });\n        console.log($scope.ageGroupsToSave);\n\n        updatePricingData['users/' + uid + '/pricing/'] = updatePricingData['babysitters/' + uid + '/pricing/'] = $scope.ageGroupsToSave;\n        $scope.database.update(updatePricingData);\n    }\n    $scope.checkForms = function() {\n        for (var i = 0; i < $scope.pricingForm.length; i++) {\n            if ($scope.pricingForm[i].$invalid) {\n                $scope.invalidPricingForm = true;\n                break;\n            } else {\n                $scope.invalidPricingForm = false;\n            }\n        }\n    }\n\n}]);"],"sourceRoot":"/source/"}