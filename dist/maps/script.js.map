{"version":3,"sources":["script.js"],"names":["app","angular","module","factory","text","document","getElementById","className","querySelector","innerHTML","setTimeout","config","$stateProvider","$urlRouterProvider","$mdThemingProvider","theme","primaryPalette","accentPalette","otherwise","state","url","templateUrl","data","pageTitle","guests","icon","controller","hidden","guest","replace","params","googleLogin","run","$rootScope","$state","$stateParams","$firebaseObject","$toast","states","get","shift","availableStates","currentUserLoaded","loggedIn","authStateLoaded","authData","apiKey","authDomain","databaseURL","storageBucket","firebase","initializeApp","auth","onAuthStateChanged","user","copy","current","name","defaultAgeGroups","codename","description","rate","database","ref","window","$on","event","toState","toParams","fromState","fromParams","options","console","group","dir","arguments","navOpen","slideAway","uid","preventDefault","go","log","groupEnd","$watch","filter","fetchUserData","currentUser","child","$loaded","then"],"mappings":"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","file":"script.js","sourcesContent":["/**\n * babysitting Module\n *\n * Description\n */\napp = angular.module('babysitting', ['ui.router', 'ngAnimate', 'ngMaterial', 'firebase', 'ngMessages', 'ngOrderObjectBy'])\n\n\napp.factory('$toast', function() {\n    return function(text) {\n        document.getElementById(\"toast\").className += \"animate\";\n        document.querySelector('#toast span').innerHTML = text;\n        setTimeout(\n            function() {\n                document.getElementById(\"toast\").className = \"\";\n            }, 3000);\n    }\n});\napp.config(['$stateProvider', '$urlRouterProvider', '$mdThemingProvider', function($stateProvider, $urlRouterProvider, $mdThemingProvider) {\n    //color config\n\n    $mdThemingProvider.theme('default')\n        .primaryPalette('indigo')\n        .accentPalette('orange');\n    //Default \n    $urlRouterProvider.otherwise('/');\n\n    $stateProvider\n        .state('main.login', {\n            url: '/login',\n            templateUrl: 'pages/login.html',\n            data: {\n                pageTitle: 'Login',\n                guests: true,\n                icon: \"vpn_key\"\n            },\n            controller: \"mainCtrl\"\n        })\n        .state('main.booking', {\n            url: '/booking/{uid}',\n            templateUrl: 'pages/booking.html',\n            data: {\n                pageTitle: 'Booking',\n                guests: false,\n                hidden: true,\n                icon: \"event_note\"\n            },\n            controller: 'bookingCtrl'\n        })\n        .state('main.babysitters', {\n            url: '/babysitters',\n            templateUrl: 'pages/babysitters.html',\n            data: {\n                pageTitle: 'babysitters',\n                guest: false,\n                icon: 'people'\n            },\n            controller: 'babysittersCtrl'\n        })\n        .state('main.register', {\n            //url: '/booking',\n            url: '/register',\n            templateUrl: 'pages/register.html',\n            replace: true,\n            data: {\n                pageTitle: 'Register',\n                guests: true,\n                icon: \"create\"\n            },\n            params: {\n                googleLogin: null\n            },\n            controller: 'registerCtrl'\n        })\n        .state('main.accountPage', {\n            url: '/account/{tab}',\n            templateUrl: 'pages/account.html',\n            data: {\n                pageTitle: 'My Account',\n                guests: false,\n                icon: \"perm_identity\"\n            },\n            controller: 'accountCtrl'\n        })\n        .state('main.children', {\n            url: '/children/{edit}',\n            templateUrl: 'pages/children.html',\n            data: {\n                pageTitle: 'My children',\n                hidden: true,\n                guests: false\n            },\n            controller: 'childrenCtrl'\n        })\n        .state('main.about', {\n            url: '/about',\n            templateUrl: 'pages/about.html',\n            data: {\n                pageTitle: 'About',\n                guests: true,\n                icon: \"info_outline\"\n            }\n        })\n}]);\n\n\n\napp.run(['$rootScope', '$state', '$stateParams', '$firebaseObject', '$toast', function($rootScope, $state, $stateParams, $firebaseObject, $toast) {\n    $rootScope.$state = $state;\n    $rootScope.states = $state.get();\n    $rootScope.states.shift();\n    $rootScope.availableStates = $rootScope.states;\n    $rootScope.currentUserLoaded = false;\n    $rootScope.loggedIn = false;\n    $rootScope.authStateLoaded = false;\n    $rootScope.authData = {};\n\n    var config = {\n        apiKey: \"AIzaSyDL6RudaDzBsZmbPMGwfrpKiErSOqVJjQk\",\n        authDomain: \"babysitting-3329b.firebaseapp.com\",\n        databaseURL: \"https://babysitting-3329b.firebaseio.com\",\n        storageBucket: \"babysitting-3329b.appspot.com\",\n    };\n    firebase.initializeApp(config);\n    firebase.auth().onAuthStateChanged(function(user) {\n        $rootScope.authStateLoaded = true;\n        if (user) {\n            $rootScope.authData = angular.copy(user);\n            $rootScope.loggedIn = true;\n        } else {\n            $rootScope.loggedIn = false;\n            if ($state.current.name != \"register\") {\n                //$state.go('login');\n            }\n        }\n    });\n\n    // Default rates & groups\n    $rootScope.defaultAgeGroups = [{\n        codename: 'A',\n        description: 'Age group 1 - 2',\n        rate: 5\n    }, {\n        codename: 'B',\n        description: 'Age group 2 - 5',\n        rate: 5\n    }, {\n        codename: 'C',\n        description: 'Age group 5 - 8',\n        rate: 5\n    }, {\n        codename: 'D',\n        description: 'Age group 8 - 12',\n        rate: 5\n    }, {\n        codename: 'E',\n        description: 'Age group 12 - 16',\n        rate: 5\n    }];\n\n\n    $rootScope.database = firebase.database().ref();\n    window['database'] = $rootScope.database;\n    $rootScope.$on('$stateChangeStart', function(event, toState, toParams, fromState, fromParams, options) {\n        console.group(\"State change event listener\");\n        console.dir(arguments[1]);\n        console.dir(arguments[3]);\n        //$rootScope.$watch('authStateLoaded').\n\n        if ($rootScope.navOpen) {\n            $rootScope.slideAway();\n        }\n        if (toState.name == 'booking' && !toParams.uid) {\n            event.preventDefault();\n            $toast('Please choose a babysitter first');\n            $state.go('babysitters');\n        }\n        // if (toState.name == 'login' && $rootScope.loggedIn && !toParams.googleLogin) {\n        //     console.log('going to booking');\n        //     event.preventDefault();\n        //     $state.go('booking');\n        // }\n        console.log($rootScope.loggedIn);\n        if (!toState.data.guests && !$rootScope.loggedIn) {\n            event.preventDefault();\n            $state.go('login');\n        }\n        console.log(toState);\n        console.groupEnd()\n    })\n\n\n    //firebase.auth().currentUser ? \n\n    $rootScope.$watch('loggedIn', function() {\n        if ($rootScope.loggedIn) {\n            $rootScope.availableStates = $rootScope.states.filter(function(state) {\n                return !state.data.guests && !state.data.hidden;\n            });\n            $rootScope.fetchUserData(firebase.auth().currentUser.uid);\n        } else {\n            $rootScope.availableStates = $rootScope.states.filter(function(state) {\n                return state.data.guests\n            });\n        }\n    });\n\n    $rootScope.fetchUserData = function(uid) {\n        $rootScope.currentUser = $firebaseObject($rootScope.database.child('users/' + uid));\n\n        $rootScope.currentUser.$loaded()\n            .then(function() {\n                $rootScope.currentUserLoaded = true;\n            })\n    }\n\n\n}]);"],"sourceRoot":"/source/"}